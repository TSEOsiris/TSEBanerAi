# –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ TSEBanerAi

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç AIInfluence, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **–ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –¥–∏–∞–ª–æ–≥–æ–≤** –≤–º–µ—Å—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫—É –ø–æ–Ω—è—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

#### 1.1. DialogueStorage - –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤ —Å NPC

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –•—Ä–∞–Ω–∏—Ç –¥–∏–∞–ª–æ–≥–∏ –ø–æ ID –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (Hero.StringId)
- –ú–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏, –æ—á–∏—Å—Ç–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –¥–∏–∞–ª–æ–≥–∞, –¥–∞—Ç–µ, —Ç–µ–º–µ

**DialogueRecord —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- NPCId (Hero.StringId)
- DialogueType (—Ç–∏–ø –¥–∏–∞–ª–æ–≥–∞)
- PlayerMessage (—Å–æ–æ–±—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞, –µ—Å–ª–∏ –µ—Å—Ç—å)
- NPCResponse (–æ—Ç–≤–µ—Ç NPC)
- Timestamp (–≤—Ä–µ–º—è –¥–∏–∞–ª–æ–≥–∞)
- Metadata (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: —Ç–µ–º–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**
- –í –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–≥—Ä—ã
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–∞–º–ø–∞–Ω–∏–∏

---

#### 1.2. CharacterStorage - –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç—å AI-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞—Ö (–º–Ω–µ–Ω–∏—è, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ ID –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

**CharacterData —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- NPCId (Hero.StringId)
- PersonalitySummary (–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏, AI-generated)
- Opinions (–º–Ω–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã: kingdom, war, trade, etc.)
- KnownTopics (—Ç–µ–º—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö NPC –º–æ–∂–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å)
- CustomData (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π)
- LastUpdated (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**
- –í –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–≥—Ä—ã
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–∞–º–ø–∞–Ω–∏–∏

---

### 2. –°–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤

#### 2.1. DialogueType - –¢–∏–ø—ã –¥–∏–∞–ª–æ–≥–æ–≤

**–ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã:**
- Greeting (–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ)
- Farewell (–ü—Ä–æ—â–∞–Ω–∏–µ)

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ:**
- AskOpinion (–£–∑–Ω–∞—Ç—å –º–Ω–µ–Ω–∏–µ –æ —á–µ–º-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º)
- AskAboutTopic (–°–ø—Ä–æ—Å–∏—Ç—å –æ —Ç–µ–º–µ)
- AskAboutPerson (–°–ø—Ä–æ—Å–∏—Ç—å –æ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ)
- AskAboutKingdom (–°–ø—Ä–æ—Å–∏—Ç—å –æ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–µ)
- AskAboutSettlement (–°–ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ—Å–µ–ª–µ–Ω–∏–∏)

**–î–µ–π—Å—Ç–≤–∏—è:**
- RequestAction (–ü–æ–ø—Ä–æ—Å–∏—Ç—å –æ –¥–µ–π—Å—Ç–≤–∏–∏)
- RequestHelp (–ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–º–æ—â–∏)
- RequestTrade (–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é)
- RequestRecruitment (–ù–∞–±–æ—Ä –≤–æ–π—Å–∫)

**–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ:**
- Compliment (–ö–æ–º–ø–ª–∏–º–µ–Ω—Ç)
- Insult (–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ)
- Gift (–ü–æ–¥–∞—Ä–æ–∫)
- Threat (–£–≥—Ä–æ–∑–∞)

**–ö–≤–µ—Å—Ç–æ–≤—ã–µ:**
- AskAboutQuest (–°–ø—Ä–æ—Å–∏—Ç—å –æ –∫–≤–µ—Å—Ç–∞—Ö)
- DiscussQuest (–û–±—Å—É–¥–∏—Ç—å –∫–≤–µ—Å—Ç)

---

#### 2.2. DialogueOption - –û–ø—Ü–∏—è –≤ –º–µ–Ω—é –¥–∏–∞–ª–æ–≥–∞

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- Text (—Ç–µ–∫—Å—Ç –æ–ø—Ü–∏–∏ –≤ –º–µ–Ω—é, –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø–∞ {kingdom})
- Type (—Ç–∏–ø –¥–∏–∞–ª–æ–≥–∞)
- IsAvailable (—É—Å–ª–æ–≤–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ - —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è NPC)
- OnSelected (–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ)
- Context (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞)

**–ü—Ä–∏–º–µ—Ä—ã –æ–ø—Ü–∏–π:**
- "What do you think about {kingdom}?" ‚Üí AskAboutKingdom, –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è Lords –∏ Notables
- "I need your help" ‚Üí RequestHelp, –¥–æ—Å—Ç—É–ø–Ω–æ –ø—Ä–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö > 10
- "Let's trade" ‚Üí RequestTrade, –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è Merchants

---

### 3. –°–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—É–Ω–∫—Ç–æ–≤ –≤ –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –º–µ–Ω—é

#### 3.1. DialogueMenuManager - –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –º–µ–Ω—é
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª—è—Ç—å –Ω–∞—à–∏ –æ–ø—Ü–∏–∏ –≤ –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –º–µ–Ω—é Bannerlord

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–ø—Ü–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–ø—Ü–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ NPC (—Å —É—á–µ—Ç–æ–º —É—Å–ª–æ–≤–∏–π)
- –ò–Ω—ä–µ–∫—Ü–∏—è –æ–ø—Ü–∏–π –≤ –º–µ–Ω—é Bannerlord (—á–µ—Ä–µ–∑ Harmony patch)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bannerlord:**
- Harmony patch –Ω–∞ –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –º–µ–Ω—é
- –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à–∏ –æ–ø—Ü–∏–∏ –≤ —Å–ø–∏—Å–æ–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ–ø—Ü–∏–π
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–∏ ‚Üí –≤—ã–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

---

#### 3.2. DialogueHandler - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∏–∞–ª–æ–≥–æ–≤
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—ã–±–æ—Ä –æ–ø—Ü–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç NPC

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- DialogueStorage (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏)
- CharacterStorage (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–∞)
- ContextBuilder (–¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
- PromptBuilder (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞)
- ILLMProvider (–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ LLM)

**–ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. –ò–≥—Ä–æ–∫ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ü–∏—é –≤ –º–µ–Ω—é
2. DialogueHandler.HandleDialogueOption() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
3. –°–æ–±–∏—Ä–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç (Tier 1 + —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∏–ø–∞ –¥–∏–∞–ª–æ–≥–∞)
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ —Ç–∏–ø –¥–∏–∞–ª–æ–≥–∞)
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –≤ LLM
6. –ü–∞—Ä—Å–∏—Ç—Å—è –æ—Ç–≤–µ—Ç (JSON –∏–ª–∏ —Ç–µ–∫—Å—Ç)
7. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ DialogueStorage
8. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è CharacterStorage (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
9. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç –≤ –∏–≥—Ä–µ

---

### 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

```
src/TSEBanerAi/
‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îú‚îÄ‚îÄ SubModule.cs              # Entry point
‚îÇ   ‚îî‚îÄ‚îÄ Config.cs                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ Storage/
‚îÇ   ‚îú‚îÄ‚îÄ DialogueStorage.cs        # –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ CharacterStorage.cs       # –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ StorageManager.cs         # –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ Models/
‚îÇ       ‚îú‚îÄ‚îÄ DialogueRecord.cs
‚îÇ       ‚îî‚îÄ‚îÄ CharacterData.cs
‚îÇ
‚îú‚îÄ‚îÄ Dialogue/
‚îÇ   ‚îú‚îÄ‚îÄ DialogueType.cs           # Enum —Ç–∏–ø–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ DialogueOption.cs        # –û–ø—Ü–∏—è –≤ –º–µ–Ω—é
‚îÇ   ‚îú‚îÄ‚îÄ DialogueMenuManager.cs   # –ú–µ–Ω–µ–¥–∂–µ—Ä –º–µ–Ω—é
‚îÇ   ‚îú‚îÄ‚îÄ DialogueHandler.cs       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ DialoguePatches.cs       # Harmony patches
‚îÇ
‚îú‚îÄ‚îÄ Context/
‚îÇ   ‚îú‚îÄ‚îÄ ContextBuilder.cs        # –°–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ ContextTier.cs           # Tier system
‚îÇ
‚îú‚îÄ‚îÄ Prompt/
‚îÇ   ‚îú‚îÄ‚îÄ PromptBuilder.cs         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ PromptTemplate.cs        # –®–∞–±–ª–æ–Ω—ã
‚îÇ
‚îú‚îÄ‚îÄ LLM/
‚îÇ   ‚îú‚îÄ‚îÄ ILLMProvider.cs
‚îÇ   ‚îî‚îÄ‚îÄ OllamaProvider.cs
‚îÇ
‚îî‚îÄ‚îÄ Utils/
    ‚îú‚îÄ‚îÄ Logger.cs
    ‚îî‚îÄ‚îÄ JsonHelper.cs
```

---

## üîÑ –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ò–≥—Ä–æ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —Å NPC

```
1. –ò–≥—Ä–æ–∫ –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ NPC –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "Talk"
   ‚Üì
2. Harmony patch –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞
   ‚Üì
3. DialogueMenuManager.GetAvailableOptions(npc) –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏
   ‚Üì
4. –û–ø—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –º–µ–Ω—é
   ‚Üì
5. –ò–≥—Ä–æ–∫ –≤–∏–¥–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–ø—Ü–∏–∏ + –Ω–∞—à–∏ –æ–ø—Ü–∏–∏:
   - "What do you think about Sturgia?" (AskAboutKingdom)
   - "I need your help" (RequestHelp)
   - "Let's trade" (RequestTrade)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–≥—Ä–æ–∫ –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–∞—à—É –æ–ø—Ü–∏—é

```
1. –ò–≥—Ä–æ–∫ –≤—ã–±–∏—Ä–∞–µ—Ç "What do you think about Sturgia?"
   ‚Üì
2. DialogueHandler.HandleDialogueOption(npc, AskAboutKingdom, "Sturgia")
   ‚Üì
3. ContextBuilder —Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç:
   - NPC: name, role, traits (top 5)
   - Dialogue type: AskAboutKingdom
   - Context: "Sturgia"
   - History: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–∏–∞–ª–æ–≥–∞
   ‚Üì
4. PromptBuilder –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç (~3-5K tokens)
   ‚Üì
5. LLM Provider –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å
   ‚Üì
6. –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç NPC
   ‚Üì
7. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ DialogueStorage
   ‚Üì
8. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ—Ç–≤–µ—Ç –≤ –¥–∏–∞–ª–æ–≥–æ–≤–æ–º –æ–∫–Ω–µ
```

---

## üíæ –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π

### –§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**dialogues.json:**
```json
{
  "dialogues": {
    "hero_sturgia_lord_1": [
      {
        "type": "AskAboutKingdom",
        "playerMessage": null,
        "npcResponse": "Sturgia is a strong kingdom...",
        "timestamp": "2025-01-XX...",
        "metadata": {
          "context": "Sturgia"
        }
      }
    ]
  }
}
```

**characters.json:**
```json
{
  "characters": {
    "hero_sturgia_lord_1": {
      "personalitySummary": "A brave and honorable lord...",
      "opinions": {
        "Sturgia": "Loyal to his kingdom",
        "Empire": "Distrusts the Empire"
      },
      "knownTopics": ["war", "politics", "trade"],
      "lastUpdated": "2025-01-XX..."
    }
  }
}
```

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `Documents/Mount and Blade II Bannerlord/Configs/TSEBanerAi/`

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

1. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:** –ó–Ω–∞–µ–º —Ç–∏–ø –¥–∏–∞–ª–æ–≥–∞ ‚Üí –º–æ–∂–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç
2. **–ü–æ–Ω—è—Ç–Ω—ã–π UI:** –ò–≥—Ä–æ–∫ –≤–∏–¥–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –∞ –Ω–µ —Å–≤–æ–±–æ–¥–Ω—ã–π –≤–≤–æ–¥
3. **–ú–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤:** –ù–µ –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
4. **–õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ:** LLM –∑–Ω–∞–µ—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
5. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∏–∞–ª–æ–≥–æ–≤

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò—Ç–µ—Ä–∞—Ü–∏—è 1:** –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã Storage
2. **–ò—Ç–µ—Ä–∞—Ü–∏—è 2:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DialogueType –∏ DialogueOption
3. **–ò—Ç–µ—Ä–∞—Ü–∏—è 3:** –°–æ–∑–¥–∞—Ç—å Harmony patch –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–ø—Ü–∏–π –≤ –º–µ–Ω—é
4. **–ò—Ç–µ—Ä–∞—Ü–∏—è 4:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DialogueHandler —Å –±–∞–∑–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
5. **–ò—Ç–µ—Ä–∞—Ü–∏—è 5:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤

---

*–°–æ–∑–¥–∞–Ω–æ: 2025-01-XX*  
*–°—Ç–∞—Ç—É—Å: –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞*

